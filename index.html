<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NYXO Brussels ‚Äî L'Outil Pour Les Gouverner Tous</title>
  <meta name="description" content="Graphe de connaissances pour la sant√© mentale et l'empowerment citoyen √† Bruxelles. Naviguez le labyrinthe.">
  <link rel="canonical" href="https://nyxo.brussels/">
  
  <!-- JSON-LD -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "@id": "https://nyxo.brussels/#app",
    "name": "NYXO Brussels",
    "description": "Graphe de connaissances pour la sant√© mentale et l'empowerment citoyen √† Bruxelles",
    "url": "https://nyxo.brussels/",
    "applicationCategory": "HealthApplication",
    "operatingSystem": "Web",
    "author": {
      "@type": "Organization",
      "name": "NYXO Brussels"
    }
  }
  </script>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=JetBrains+Mono:wght@400;700&family=Spectral:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
  
  <style>
    :root {
      /* Mode Gandalf (d√©faut) - tons chauds, parchemin, magie */
      --bg-primary: #1a1714;
      --bg-secondary: #2d2520;
      --bg-tertiary: #3d332a;
      --text-primary: #e8dcc8;
      --text-secondary: #a89880;
      --text-muted: #6d5d4d;
      --accent-primary: #d4a853;
      --accent-secondary: #8b6914;
      --accent-glow: rgba(212, 168, 83, 0.3);
      --border-color: #4d3d2d;
      --success: #6d9f71;
      --warning: #d4853a;
      --danger: #a85353;
      --font-display: 'Cinzel', serif;
      --font-body: 'Spectral', serif;
      --font-mono: 'JetBrains Mono', monospace;
      --transition-speed: 0.3s;
      --glow-effect: 0 0 20px var(--accent-glow);
    }
    
    [data-mode="smith"] {
      /* Mode Agent Smith - matrix, froid, efficace */
      --bg-primary: #0a0a0a;
      --bg-secondary: #0d1a0d;
      --bg-tertiary: #1a2d1a;
      --text-primary: #00ff41;
      --text-secondary: #008f11;
      --text-muted: #004d0a;
      --accent-primary: #00ff41;
      --accent-secondary: #00cc33;
      --accent-glow: rgba(0, 255, 65, 0.2);
      --border-color: #003d0a;
      --success: #00ff41;
      --warning: #ffcc00;
      --danger: #ff0040;
      --font-display: 'JetBrains Mono', monospace;
      --font-body: 'JetBrains Mono', monospace;
      --glow-effect: 0 0 10px var(--accent-glow), 0 0 20px var(--accent-glow);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html {
      font-size: 16px;
      scroll-behavior: smooth;
    }
    
    body {
      font-family: var(--font-body);
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      transition: background var(--transition-speed), color var(--transition-speed);
    }
    
    /* Background effects */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(ellipse at 20% 20%, var(--accent-glow) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, var(--accent-glow) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }
    
    [data-mode="smith"] body::before {
      background: 
        repeating-linear-gradient(
          0deg,
          transparent,
          transparent 2px,
          rgba(0, 255, 65, 0.03) 2px,
          rgba(0, 255, 65, 0.03) 4px
        );
      animation: scanlines 10s linear infinite;
    }
    
    @keyframes scanlines {
      0% { transform: translateY(0); }
      100% { transform: translateY(100px); }
    }
    
    /* Header */
    header {
      padding: 2rem;
      text-align: center;
      border-bottom: 1px solid var(--border-color);
      position: relative;
    }
    
    .logo {
      font-family: var(--font-display);
      font-size: 3rem;
      font-weight: 700;
      letter-spacing: 0.2em;
      color: var(--accent-primary);
      text-shadow: var(--glow-effect);
      margin-bottom: 0.5rem;
    }
    
    .tagline {
      font-style: italic;
      color: var(--text-secondary);
      font-size: 1.1rem;
    }
    
    .mode-toggle {
      position: absolute;
      top: 1rem;
      right: 1rem;
      display: flex;
      gap: 0.5rem;
    }
    
    .mode-btn {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
      padding: 0.5rem 1rem;
      font-family: var(--font-mono);
      font-size: 0.75rem;
      cursor: pointer;
      transition: all var(--transition-speed);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }
    
    .mode-btn:hover, .mode-btn.active {
      background: var(--accent-primary);
      color: var(--bg-primary);
      border-color: var(--accent-primary);
      box-shadow: var(--glow-effect);
    }
    
    /* Navigation */
    nav {
      display: flex;
      justify-content: center;
      gap: 2rem;
      padding: 1rem;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      flex-wrap: wrap;
    }
    
    nav a {
      color: var(--text-secondary);
      text-decoration: none;
      font-family: var(--font-display);
      font-size: 0.9rem;
      letter-spacing: 0.1em;
      padding: 0.5rem 1rem;
      border: 1px solid transparent;
      transition: all var(--transition-speed);
    }
    
    nav a:hover, nav a.active {
      color: var(--accent-primary);
      border-color: var(--accent-primary);
      text-shadow: var(--glow-effect);
    }
    
    /* Main content */
    main {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }
    
    /* Search */
    .search-container {
      margin-bottom: 2rem;
    }
    
    .search-box {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    
    .search-input {
      flex: 1;
      background: var(--bg-secondary);
      border: 2px solid var(--border-color);
      color: var(--text-primary);
      padding: 1rem 1.5rem;
      font-family: var(--font-body);
      font-size: 1.1rem;
      transition: all var(--transition-speed);
    }
    
    .search-input:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: var(--glow-effect);
    }
    
    .search-input::placeholder {
      color: var(--text-muted);
      font-style: italic;
    }
    
    .search-btn {
      background: var(--accent-primary);
      border: none;
      color: var(--bg-primary);
      padding: 1rem 2rem;
      font-family: var(--font-display);
      font-weight: 700;
      cursor: pointer;
      transition: all var(--transition-speed);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }
    
    .search-btn:hover {
      box-shadow: var(--glow-effect);
      transform: translateY(-2px);
    }
    
    /* Filters */
    .filters {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }
    
    .filter-btn {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
      padding: 0.4rem 0.8rem;
      font-family: var(--font-mono);
      font-size: 0.75rem;
      cursor: pointer;
      transition: all var(--transition-speed);
    }
    
    .filter-btn:hover, .filter-btn.active {
      background: var(--accent-secondary);
      color: var(--text-primary);
      border-color: var(--accent-primary);
    }
    
    /* Stats bar */
    .stats-bar {
      display: flex;
      justify-content: center;
      gap: 3rem;
      padding: 1.5rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      margin-bottom: 2rem;
    }
    
    .stat {
      text-align: center;
    }
    
    .stat-value {
      font-family: var(--font-display);
      font-size: 2rem;
      color: var(--accent-primary);
      text-shadow: var(--glow-effect);
    }
    
    .stat-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }
    
    /* Results grid */
    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 1.5rem;
    }
    
    /* Entity card */
    .entity-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      padding: 1.5rem;
      transition: all var(--transition-speed);
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    
    .entity-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: var(--accent-primary);
      transform: scaleY(0);
      transition: transform var(--transition-speed);
    }
    
    .entity-card:hover {
      border-color: var(--accent-primary);
      box-shadow: var(--glow-effect);
      transform: translateY(-4px);
    }
    
    .entity-card:hover::before {
      transform: scaleY(1);
    }
    
    .entity-type {
      display: inline-block;
      font-family: var(--font-mono);
      font-size: 0.7rem;
      color: var(--accent-primary);
      background: var(--bg-tertiary);
      padding: 0.2rem 0.5rem;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }
    
    .entity-name {
      font-family: var(--font-display);
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }
    
    .entity-description {
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-bottom: 1rem;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .entity-meta {
      display: flex;
      gap: 1rem;
      font-family: var(--font-mono);
      font-size: 0.7rem;
      color: var(--text-muted);
    }
    
    .entity-meta span {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    
    .confidence-bar {
      width: 50px;
      height: 4px;
      background: var(--bg-tertiary);
      border-radius: 2px;
      overflow: hidden;
    }
    
    .confidence-fill {
      height: 100%;
      background: var(--accent-primary);
      transition: width var(--transition-speed);
    }
    
    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition-speed);
    }
    
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .modal {
      background: var(--bg-secondary);
      border: 2px solid var(--accent-primary);
      max-width: 700px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      padding: 2rem;
      position: relative;
      box-shadow: var(--glow-effect);
    }
    
    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.5rem;
      cursor: pointer;
      transition: color var(--transition-speed);
    }
    
    .modal-close:hover {
      color: var(--accent-primary);
    }
    
    .modal h2 {
      font-family: var(--font-display);
      color: var(--accent-primary);
      margin-bottom: 1rem;
      padding-right: 2rem;
    }
    
    .modal-section {
      margin-bottom: 1.5rem;
    }
    
    .modal-section h3 {
      font-family: var(--font-mono);
      font-size: 0.8rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 0.5rem;
    }
    
    .modal-section p, .modal-section a {
      color: var(--text-secondary);
    }
    
    .modal-section a {
      color: var(--accent-primary);
      text-decoration: none;
    }
    
    .modal-section a:hover {
      text-decoration: underline;
    }
    
    .tag-list {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    
    .tag {
      background: var(--bg-tertiary);
      padding: 0.3rem 0.6rem;
      font-family: var(--font-mono);
      font-size: 0.75rem;
      color: var(--accent-primary);
      border: 1px solid var(--border-color);
    }
    
    /* Flashcard section */
    .flashcard-container {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      padding: 2rem;
      margin-top: 2rem;
      text-align: center;
    }
    
    .flashcard {
      min-height: 200px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      perspective: 1000px;
    }
    
    .flashcard-inner {
      position: relative;
      width: 100%;
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    
    .flashcard.flipped .flashcard-inner {
      transform: rotateY(180deg);
    }
    
    .flashcard-front, .flashcard-back {
      backface-visibility: hidden;
      padding: 2rem;
    }
    
    .flashcard-back {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      transform: rotateY(180deg);
      background: var(--bg-tertiary);
      border: 1px solid var(--accent-primary);
    }
    
    .flashcard-question {
      font-family: var(--font-display);
      font-size: 1.3rem;
      color: var(--text-primary);
      margin-bottom: 1rem;
    }
    
    .flashcard-answer {
      font-size: 1.1rem;
      color: var(--accent-primary);
    }
    
    .flashcard-controls {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 1.5rem;
    }
    
    .flashcard-btn {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
      padding: 0.7rem 1.5rem;
      font-family: var(--font-mono);
      cursor: pointer;
      transition: all var(--transition-speed);
    }
    
    .flashcard-btn:hover {
      border-color: var(--accent-primary);
      color: var(--accent-primary);
    }
    
    /* Easter eggs */
    .easter-egg {
      position: fixed;
      bottom: 1rem;
      left: 1rem;
      font-family: var(--font-mono);
      font-size: 0.7rem;
      color: var(--text-muted);
      opacity: 0.5;
      transition: opacity var(--transition-speed);
    }
    
    .easter-egg:hover {
      opacity: 1;
      color: var(--accent-primary);
    }
    
    /* Quotes */
    .quote {
      text-align: center;
      padding: 2rem;
      font-style: italic;
      color: var(--text-secondary);
      border-left: 3px solid var(--accent-primary);
      margin: 2rem 0;
      background: var(--bg-secondary);
    }
    
    .quote-author {
      margin-top: 0.5rem;
      font-family: var(--font-mono);
      font-size: 0.8rem;
      color: var(--text-muted);
    }
    
    /* Footer */
    footer {
      text-align: center;
      padding: 2rem;
      border-top: 1px solid var(--border-color);
      margin-top: 4rem;
    }
    
    footer p {
      color: var(--text-muted);
      font-size: 0.9rem;
    }
    
    footer a {
      color: var(--accent-primary);
      text-decoration: none;
    }
    
    /* Export button */
    .export-btn {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
      padding: 0.7rem 1rem;
      font-family: var(--font-mono);
      font-size: 0.75rem;
      cursor: pointer;
      transition: all var(--transition-speed);
    }
    
    .export-btn:hover {
      border-color: var(--accent-primary);
      color: var(--accent-primary);
      box-shadow: var(--glow-effect);
    }
    
    /* Loading */
    .loading {
      text-align: center;
      padding: 4rem;
      font-family: var(--font-mono);
      color: var(--text-muted);
    }
    
    .loading::after {
      content: '';
      animation: dots 1.5s infinite;
    }
    
    @keyframes dots {
      0%, 20% { content: '.'; }
      40% { content: '..'; }
      60%, 100% { content: '...'; }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .logo { font-size: 2rem; }
      nav { gap: 1rem; }
      nav a { font-size: 0.8rem; padding: 0.3rem 0.5rem; }
      .stats-bar { gap: 1.5rem; flex-wrap: wrap; }
      .stat-value { font-size: 1.5rem; }
      .results-grid { grid-template-columns: 1fr; }
      .mode-toggle { position: static; justify-content: center; margin-top: 1rem; }
      header { padding: 1rem; }
    }
    
    /* Print styles */
    @media print {
      body { background: white; color: black; }
      .mode-toggle, .export-btn, .easter-egg { display: none; }
    }
  </style>
</head>
<body data-mode="gandalf">
  
  <header>
    <div class="mode-toggle">
      <button class="mode-btn active" data-mode="gandalf" title="Mode Gandalf - Sage et ludique">üßô Gandalf</button>
      <button class="mode-btn" data-mode="smith" title="Mode Agent Smith - Efficace et froid">üï¥Ô∏è Smith</button>
    </div>
    <h1 class="logo">NYXO</h1>
    <p class="tagline" id="tagline">¬´ Un Outil pour les gouverner tous ¬ª</p>
  </header>
  
  <nav>
    <a href="#search" class="active">Recherche</a>
    <a href="#graph">Graphe</a>
    <a href="#flashcards">Flashcards</a>
    <a href="#about">√Ä propos</a>
    <a href="#export">Export</a>
  </nav>
  
  <main>
    <div class="quote" id="quote">
      <p>¬´ Tout ce que nous avons √† d√©cider, c'est ce que nous devons faire du temps qui nous est imparti. ¬ª</p>
      <div class="quote-author">‚Äî Gandalf, Le Seigneur des Anneaux</div>
    </div>
    
    <div class="stats-bar" id="stats">
      <div class="stat">
        <div class="stat-value" id="stat-entities">‚Äî</div>
        <div class="stat-label">Entit√©s</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="stat-relations">‚Äî</div>
        <div class="stat-label">Relations</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="stat-zones">‚Äî</div>
        <div class="stat-label">Zones</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="stat-flashcards">‚Äî</div>
        <div class="stat-label">Flashcards</div>
      </div>
    </div>
    
    <section id="search" class="search-container">
      <div class="search-box">
        <input type="text" class="search-input" id="searchInput" placeholder="Cherchez dans le labyrinthe... (ex: SSM, CPAS, sant√© mentale, Schaerbeek)">
        <button class="search-btn" id="searchBtn">Chercher</button>
      </div>
      
      <div class="filters" id="filters">
        <button class="filter-btn active" data-filter="all">Tout</button>
        <button class="filter-btn" data-filter="institution">Institutions</button>
        <button class="filter-btn" data-filter="service">Services</button>
        <button class="filter-btn" data-filter="ssm">SSM</button>
        <button class="filter-btn" data-filter="association">Associations</button>
        <button class="filter-btn" data-filter="concept">Concepts</button>
      </div>
    </section>
    
    <section id="results">
      <div class="loading" id="loading">Chargement du graphe de connaissances</div>
      <div class="results-grid" id="resultsGrid"></div>
    </section>
    
    <section id="flashcards" class="flashcard-container" style="display: none;">
      <h2 style="font-family: var(--font-display); color: var(--accent-primary); margin-bottom: 1rem;">
        Flashcards ‚Äî Testez vos connaissances
      </h2>
      <div class="flashcard" id="flashcard">
        <div class="flashcard-inner">
          <div class="flashcard-front">
            <p class="flashcard-question" id="flashcardQuestion">‚Äî</p>
          </div>
          <div class="flashcard-back">
            <p class="flashcard-answer" id="flashcardAnswer">‚Äî</p>
          </div>
        </div>
      </div>
      <div class="flashcard-controls">
        <button class="flashcard-btn" id="prevCard">‚Üê Pr√©c√©dent</button>
        <button class="flashcard-btn" id="flipCard">Retourner</button>
        <button class="flashcard-btn" id="nextCard">Suivant ‚Üí</button>
      </div>
      <p style="margin-top: 1rem; font-family: var(--font-mono); font-size: 0.8rem; color: var(--text-muted);">
        Carte <span id="cardIndex">1</span> / <span id="cardTotal">‚Äî</span>
      </p>
    </section>
  </main>
  
  <!-- Modal -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal" id="modal">
      <button class="modal-close" id="modalClose">√ó</button>
      <h2 id="modalTitle">‚Äî</h2>
      <div id="modalContent"></div>
    </div>
  </div>
  
  <button class="export-btn" id="exportBtn" title="Exporter les donn√©es en JSON-LD">
    üì§ Export JSON-LD
  </button>
  
  <div class="easter-egg" id="easterEgg">
    /* You shall not pass... without data */
  </div>
  
  <footer>
    <p>
      NYXO Brussels ‚Äî 
      <a href="https://nyxo.brussels/nyxo-unified.json" target="_blank">Donn√©es ouvertes (JSON-LD)</a> ‚Äî 
      <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0</a>
    </p>
    <p style="margin-top: 0.5rem; font-size: 0.8rem;">
      ¬´ The Matrix has you... but so does the social safety net. ¬ª
    </p>
  </footer>

  <script>
    // ============================================
    // NYXO Brussels - Main Application
    // "One Ring to rule them all"
    // ============================================
    
    const QUOTES = {
      gandalf: [
        { text: "Tout ce que nous avons √† d√©cider, c'est ce que nous devons faire du temps qui nous est imparti.", author: "Gandalf, Le Seigneur des Anneaux" },
        { text: "Un magicien n'est jamais en retard, ni en avance. Il arrive pr√©cis√©ment quand il le d√©cide.", author: "Gandalf" },
        { text: "M√™me la plus petite personne peut changer le cours de l'avenir.", author: "Galadriel" },
        { text: "Il y a d'autres forces en ce monde que le mal.", author: "Gandalf" },
        { text: "Le monde est plein de dangers, et il y a de nombreux endroits sombres.", author: "Haldir" }
      ],
      smith: [
        { text: "Je voudrais partager une r√©v√©lation que j'ai eue durant mon s√©jour ici.", author: "Agent Smith, The Matrix" },
        { text: "Vous entendez ? C'est le son de l'in√©vitabilit√©.", author: "Agent Smith" },
        { text: "Il n'y a pas de cuill√®re.", author: "L'enfant, The Matrix" },
        { text: "La Matrice est partout. Elle est tout autour de nous.", author: "Morpheus" },
        { text: "Je ne peux que vous montrer la porte. C'est vous qui devez la franchir.", author: "Morpheus" }
      ]
    };
    
    const TAGLINES = {
      gandalf: "¬´ Un Outil pour les gouverner tous ¬ª",
      smith: "¬´ Welcome to the real world. ¬ª"
    };
    
    let data = null;
    let currentFilter = 'all';
    let currentSearch = '';
    let currentCardIndex = 0;
    let currentMode = 'gandalf';
    
    // ============================================
    // Data Loading
    // ============================================
    
    async function loadData() {
      try {
        const response = await fetch('nyxo-unified.json');
        data = await response.json();
        
        document.getElementById('stat-entities').textContent = data.statistics.entities;
        document.getElementById('stat-relations').textContent = data.statistics.relations;
        document.getElementById('stat-zones').textContent = data.statistics.zones;
        document.getElementById('stat-flashcards').textContent = data.statistics.flashcards;
        
        document.getElementById('loading').style.display = 'none';
        document.getElementById('cardTotal').textContent = data.flashcards.length;
        
        renderResults(data.entities.slice(0, 50));
        updateFlashcard();
        
        console.log(`%c NYXO Brussels loaded: ${data.statistics.entities} entities`, 
          'color: #d4a853; font-size: 14px; font-weight: bold;');
        console.log('%c "You shall not pass... without proper documentation."', 
          'color: #888; font-style: italic;');
          
      } catch (error) {
        console.error('Failed to load data:', error);
        document.getElementById('loading').textContent = 'Erreur de chargement. V√©rifiez que nyxo-unified.json existe.';
      }
    }
    
    // ============================================
    // Rendering
    // ============================================
    
    function renderResults(entities) {
      const grid = document.getElementById('resultsGrid');
      grid.innerHTML = '';
      
      if (entities.length === 0) {
        grid.innerHTML = `
          <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: var(--text-muted);">
            <p style="font-size: 1.2rem;">Aucun r√©sultat trouv√©</p>
            <p style="font-size: 0.9rem; margin-top: 0.5rem;">
              ${currentMode === 'gandalf' 
                ? "¬´ M√™me les sages ne peuvent pas tout savoir. ¬ª" 
                : "¬´ Query returned NULL. ¬ª"}
            </p>
          </div>
        `;
        return;
      }
      
      entities.forEach(entity => {
        const card = document.createElement('div');
        card.className = 'entity-card';
        card.onclick = () => openModal(entity);
        
        const type = entity['nyxo:entityType'] || entity['@type'] || 'Thing';
        const confidence = entity['nyxo:confidence'] || 0.5;
        const zone = entity['nyxo:zone'] ? entity['nyxo:zone'].split('/').pop() : null;
        
        card.innerHTML = `
          <span class="entity-type">${type}</span>
          <h3 class="entity-name">${entity.name || 'Sans nom'}</h3>
          <p class="entity-description">${entity.description || 'Pas de description disponible.'}</p>
          <div class="entity-meta">
            ${zone ? `<span>üìç ${zone.replace('Z-', '')}</span>` : ''}
            <span>
              Confiance: 
              <span class="confidence-bar">
                <span class="confidence-fill" style="width: ${confidence * 100}%"></span>
              </span>
            </span>
          </div>
        `;
        
        grid.appendChild(card);
      });
    }
    
    // ============================================
    // Search & Filter
    // ============================================
    
    function search() {
      if (!data) return;
      
      currentSearch = document.getElementById('searchInput').value.toLowerCase().trim();
      
      let filtered = data.entities;
      
      // Text search
      if (currentSearch) {
        filtered = filtered.filter(e => {
          const searchable = [
            e.name,
            e.description,
            e.alternateName,
            e['nyxo:entityType'],
            e['nyxo:category'],
            ...(e['nyxo:tags'] || [])
          ].filter(Boolean).join(' ').toLowerCase();
          
          return searchable.includes(currentSearch);
        });
      }
      
      // Type filter
      if (currentFilter !== 'all') {
        filtered = filtered.filter(e => {
          const type = e['nyxo:entityType'] || '';
          return type.toLowerCase().includes(currentFilter);
        });
      }
      
      renderResults(filtered.slice(0, 100));
    }
    
    // ============================================
    // Modal
    // ============================================
    
    function openModal(entity) {
      const overlay = document.getElementById('modalOverlay');
      const title = document.getElementById('modalTitle');
      const content = document.getElementById('modalContent');
      
      title.textContent = entity.name || 'Entit√©';
      
      let html = '';
      
      if (entity.description) {
        html += `
          <div class="modal-section">
            <h3>Description</h3>
            <p>${entity.description}</p>
          </div>
        `;
      }
      
      if (entity.url) {
        html += `
          <div class="modal-section">
            <h3>Site web</h3>
            <a href="${entity.url.startsWith('http') ? entity.url : 'https://' + entity.url}" target="_blank">${entity.url}</a>
          </div>
        `;
      }
      
      if (entity.email) {
        html += `
          <div class="modal-section">
            <h3>Contact</h3>
            <a href="mailto:${entity.email}">${entity.email}</a>
          </div>
        `;
      }
      
      if (entity.telephone) {
        html += `
          <div class="modal-section">
            <h3>T√©l√©phone</h3>
            <p>${entity.telephone}</p>
          </div>
        `;
      }
      
      if (entity.address) {
        html += `
          <div class="modal-section">
            <h3>Adresse</h3>
            <p>
              ${entity.address.streetAddress || ''}<br>
              ${entity.address.postalCode || ''} ${entity.address.addressLocality || ''}
            </p>
          </div>
        `;
      }
      
      if (entity['nyxo:tags'] && entity['nyxo:tags'].length > 0) {
        html += `
          <div class="modal-section">
            <h3>Tags</h3>
            <div class="tag-list">
              ${entity['nyxo:tags'].map(t => `<span class="tag">${t}</span>`).join('')}
            </div>
          </div>
        `;
      }
      
      // JSON-LD export link
      html += `
        <div class="modal-section">
          <h3>Donn√©es li√©es</h3>
          <p style="font-family: var(--font-mono); font-size: 0.8rem; word-break: break-all;">
            @id: <a href="${entity['@id']}" target="_blank">${entity['@id']}</a>
          </p>
        </div>
      `;
      
      content.innerHTML = html;
      overlay.classList.add('active');
    }
    
    function closeModal() {
      document.getElementById('modalOverlay').classList.remove('active');
    }
    
    // ============================================
    // Flashcards
    // ============================================
    
    function updateFlashcard() {
      if (!data || !data.flashcards.length) return;
      
      const card = data.flashcards[currentCardIndex];
      document.getElementById('flashcardQuestion').textContent = card.text;
      document.getElementById('flashcardAnswer').textContent = card.acceptedAnswer.text;
      document.getElementById('cardIndex').textContent = currentCardIndex + 1;
      
      // Reset flip state
      document.getElementById('flashcard').classList.remove('flipped');
    }
    
    function nextCard() {
      if (!data) return;
      currentCardIndex = (currentCardIndex + 1) % data.flashcards.length;
      updateFlashcard();
    }
    
    function prevCard() {
      if (!data) return;
      currentCardIndex = (currentCardIndex - 1 + data.flashcards.length) % data.flashcards.length;
      updateFlashcard();
    }
    
    function flipCard() {
      document.getElementById('flashcard').classList.toggle('flipped');
    }
    
    // ============================================
    // Mode Toggle
    // ============================================
    
    function setMode(mode) {
      currentMode = mode;
      document.body.setAttribute('data-mode', mode);
      
      // Update buttons
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.mode === mode);
      });
      
      // Update tagline
      document.getElementById('tagline').textContent = TAGLINES[mode];
      
      // Update quote
      const quotes = QUOTES[mode];
      const quote = quotes[Math.floor(Math.random() * quotes.length)];
      document.getElementById('quote').innerHTML = `
        <p>¬´ ${quote.text} ¬ª</p>
        <div class="quote-author">‚Äî ${quote.author}</div>
      `;
      
      // Easter egg update
      const easterEgg = document.getElementById('easterEgg');
      easterEgg.textContent = mode === 'gandalf' 
        ? '/* You shall not pass... without data */'
        : '/* rm -rf /reality */';
    }
    
    // ============================================
    // Export
    // ============================================
    
    function exportData() {
      if (!data) return;
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/ld+json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'nyxo-unified.jsonld';
      a.click();
      URL.revokeObjectURL(url);
    }
    
    // ============================================
    // Navigation
    // ============================================
    
    function handleNav(e) {
      e.preventDefault();
      const href = e.target.getAttribute('href');
      
      document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
      e.target.classList.add('active');
      
      // Show/hide sections
      const flashcardsSection = document.querySelector('#flashcards');
      const resultsSection = document.querySelector('#results');
      const searchSection = document.querySelector('.search-container');
      
      if (href === '#flashcards') {
        flashcardsSection.style.display = 'block';
        resultsSection.style.display = 'none';
        searchSection.style.display = 'none';
      } else if (href === '#export') {
        exportData();
      } else {
        flashcardsSection.style.display = 'none';
        resultsSection.style.display = 'block';
        searchSection.style.display = 'block';
      }
    }
    
    // ============================================
    // Event Listeners
    // ============================================
    
    document.addEventListener('DOMContentLoaded', () => {
      loadData();
      
      // Search
      document.getElementById('searchBtn').addEventListener('click', search);
      document.getElementById('searchInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') search();
      });
      
      // Filters
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentFilter = btn.dataset.filter;
          search();
        });
      });
      
      // Modal
      document.getElementById('modalClose').addEventListener('click', closeModal);
      document.getElementById('modalOverlay').addEventListener('click', (e) => {
        if (e.target === e.currentTarget) closeModal();
      });
      
      // Flashcards
      document.getElementById('flipCard').addEventListener('click', flipCard);
      document.getElementById('nextCard').addEventListener('click', nextCard);
      document.getElementById('prevCard').addEventListener('click', prevCard);
      
      // Mode toggle
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.addEventListener('click', () => setMode(btn.dataset.mode));
      });
      
      // Export
      document.getElementById('exportBtn').addEventListener('click', exportData);
      
      // Navigation
      document.querySelectorAll('nav a').forEach(a => {
        a.addEventListener('click', handleNav);
      });
      
      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeModal();
        if (e.key === 'g' && e.ctrlKey) { e.preventDefault(); setMode('gandalf'); }
        if (e.key === 's' && e.ctrlKey && e.shiftKey) { e.preventDefault(); setMode('smith'); }
      });
      
      // Easter egg - Konami code
      let konamiCode = [];
      const konamiSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
      document.addEventListener('keydown', (e) => {
        konamiCode.push(e.key);
        konamiCode = konamiCode.slice(-10);
        if (konamiCode.join(',') === konamiSequence.join(',')) {
          document.body.style.animation = 'rainbow 2s linear infinite';
          setTimeout(() => document.body.style.animation = '', 3000);
        }
      });
    });
  </script>
</body>
</html>
